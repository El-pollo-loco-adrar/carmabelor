---
import Layout from '../layouts/Layout.astro';
import categories from '../data/services.json'; 

// 1. On définit la structure précise d'un service
interface Service {
    name: string;
    price: string;
    duration: string;
    description?: string; 
    badge?: string;       
}

// 2. On définit la structure d'une catégorie
interface Category {
    id: string;
    name: string;
    icon: string;
    services: Service[];
}

// 3. On force le type sur nos données importées
const typedCategories = categories as Category[];
---

<Layout 
    title = "Tarifs & Soins Maria Galland | Institut Carmabelor à Toulouse"
    description ="Consultez la carte de nos soins : massage Kobido, LPG Endermologie et beauté du regard dans le quartier des Carmes à Toulouse."
>
    <section class="max-w-6xl mx-auto py-12 px-4 min-h-screen">
        <div class="flex flex-col md:flex-row gap-8">
            
            <aside class="md:w-1/3">
                <ul class="menu bg-base-200 p-4 rounded-box gap-2 sticky top-24 shadow-sm border border-base-300">
                    <li class="menu-title font-serif text-lg text-primary">Nos Univers</li>
                    {categories.map((cat, index) => (
                        <li>
                            <button 
                                class={`category-btn flex justify-between ${index === 0 ? 'active' : ''}`}
                                data-target={cat.id}
                            >
                                <span>{cat.icon} {cat.name}</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 opacity-50" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                </svg>
                            </button>
                        </li>
                    ))}
                </ul>
            </aside>

            <div class="md:w-2/3">
                {typedCategories.map((cat, index) => (
                    <div 
                        id={cat.id} 
                        class={`category-content space-y-8 animate-fadeIn ${index === 0 ? 'block' : 'hidden'}`}
                    >
                        <div class="flex justify-between items-end border-b-2 border-primary/10 pb-4">
                            <h2 class="text-3xl font-semibold font-serif">{cat.name}</h2>
                            <span class="text-xs uppercase tracking-widest opacity-60 font-bold">{cat.services.length} prestations</span>
                        </div>

                        <div class="grid gap-8">
                            {cat.services.map((s: Service) => (
                                <div class="flex flex-col gap-1 group">
                                    <div class="flex justify-between items-baseline gap-4">
                                        <div class="flex items-center gap-3">
                                            <h4 class="text-lg font-bold group-hover:text-primary transition-colors tracking-tight">
                                                {s.name}
                                            </h4>
                                            
                                            {s.badge && (
                                                <span class="badge badge-primary badge-outline badge-sm font-bold uppercase text-[10px] tracking-tighter italic">
                                                    {s.badge}
                                                </span>
                                            )}
                                        </div>
                                        
                                        <div class="flex-grow border-b border-dotted border-neutral/20"></div>
                                        <span class="text-xl font-bold text-primary">{s.price}</span>
                                    </div>

                                    <div class="flex items-center gap-2 text-xs text-neutral/50 uppercase tracking-widest font-semibold">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        {s.duration}
                                    </div>

                                    {s.description && (
                                        <p class="text-sm text-neutral/70 mt-1 max-w-xl leading-relaxed italic">
                                            {s.description}
                                        </p>
                                    )}
                                </div>
                            ))}
                        </div>

                    </div>
                ))}
            </div>
        </div>
    </section>
</Layout>

<script>
    const buttons = document.querySelectorAll('.category-btn');
    const contents = document.querySelectorAll('.category-content');

    // Fonction réutilisable pour changer de catégorie
    function switchCategory(targetId: string | null) {
        if (!targetId) return;

        // 1. Mise à jour de l'état visuel des boutons
        buttons.forEach(b => {
            if (b.getAttribute('data-target') === targetId) {
                b.classList.add('active');
            } else {
                b.classList.remove('active');
            }
        });

        // 2. Mise à jour de l'affichage du contenu
        contents.forEach(content => {
            if (content.id === targetId) {
                content.classList.remove('hidden');
                content.classList.add('block');
            } else {
                content.classList.add('hidden');
                content.classList.remove('block');
            }
        });
    }

    // --- LOGIQUE AU CLIC ---
    buttons.forEach(btn => {
        btn.addEventListener('click', () => {
            const targetId = btn.getAttribute('data-target');
            switchCategory(targetId);

            // Optionnel : scroll auto sur mobile
            if (window.innerWidth < 768) {
                window.scrollTo({ top: 200, behavior: 'smooth' });
            }
        });
    });

    // --- LOGIQUE AU CHARGEMENT DE LA PAGE ---
    window.addEventListener('DOMContentLoaded', () => {
        // On récupère le paramètre "category" dans l'URL (ex: ?category=corps)
        const urlParams = new URLSearchParams(window.location.search);
        const categoryParam = urlParams.get('category');
        
        if (categoryParam) {
            // Si le paramètre existe, on active la bonne catégorie
            switchCategory(categoryParam);
            
            // On scrolle doucement vers la partie contenu pour une meilleure expérience
            const targetElement = document.getElementById(categoryParam);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
    });
</script>

<style>
    .animate-fadeIn {
        animation: fadeIn 0.3s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
</style>